<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>adv_vfedorov ‚Äî Telegram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
        }

        .header {
            background: linear-gradient(135deg, #2AABEE, #229ED9);
            color: white;
            padding: 25px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }

        .header h1 { font-size: 22px; margin-bottom: 4px; }
        .header a { color: white; text-decoration: none; font-size: 14px; opacity: 0.9; }

        .container {
            max-width: 700px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .widget-post {
            margin-bottom: 12px;
            border-radius: 12px;
            overflow: hidden;
        }

        .loading-info {
            text-align: center;
            padding: 30px;
            color: #888;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0 30px;
        }

        .nav-buttons button {
            padding: 12px 30px;
            background: #2AABEE;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .nav-buttons button:hover {
            background: #1a9ad9;
        }

        .nav-buttons button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>üì¢ adv_vfedorov</h1>
        <a href="https://t.me/adv_vfedorov" target="_blank">–û—Ç–∫—Ä—ã—Ç—å –≤ Telegram ‚Üí</a>
    </div>

    <div class="container">
        <div class="loading-info" id="loadingInfo">
            –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...
        </div>
        <div id="postsContainer"></div>
        <div class="nav-buttons">
            <button id="loadMoreBtn" onclick="loadMorePosts()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
        </div>
    </div>

    <script>
        const CHANNEL = 'adv_vfedorov';
        let currentMaxId = 0;
        let loadedIds = new Set();
        const POSTS_PER_PAGE = 15;

        async function findLatestPostId() {
            // –ü–∞—Ä—Å–∏–º t.me/s/ —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π ID
            const proxies = [
                (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`,
                (u) => `https://corsproxy.io/?${encodeURIComponent(u)}`,
            ];

            for (const proxy of proxies) {
                try {
                    const resp = await fetch(proxy(`https://t.me/s/${CHANNEL}`), {
                        signal: AbortSignal.timeout(8000)
                    });
                    const html = await resp.text();
                    const matches = html.match(/data-post="[^"]*\/(\d+)"/g);
                    if (matches && matches.length > 0) {
                        const ids = matches.map(m => {
                            const num = m.match(/\/(\d+)"/);
                            return num ? parseInt(num[1]) : 0;
                        });
                        return Math.max(...ids);
                    }
                } catch (e) {
                    console.log('Failed to find latest ID via proxy');
                }
            }

            // Fallback: –±–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫
            return await binarySearchLatestId();
        }

        async function binarySearchLatestId() {
            let low = 1, high = 5000, result = 1;

            while (low <= high) {
                const mid = Math.floor((low + high) / 2);
                const exists = await checkPostExists(mid);
                if (exists) {
                    result = mid;
                    low = mid + 1;
                } else {
                    high = mid - 1;
                }
            }

            return result;
        }

        function checkPostExists(id) {
            return new Promise((resolve) => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = `https://t.me/${CHANNEL}/${id}?embed=1`;

                const timeout = setTimeout(() => {
                    iframe.remove();
                    resolve(false);
                }, 3000);

                iframe.onload = () => {
                    clearTimeout(timeout);
                    try {
                        // –ï—Å–ª–∏ –ø–æ—Å—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, iframe –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
                        resolve(true);
                    } catch (e) {
                        resolve(true); // cross-origin, –Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è = —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                    }
                    iframe.remove();
                };

                iframe.onerror = () => {
                    clearTimeout(timeout);
                    resolve(false);
                    iframe.remove();
                };

                document.body.appendChild(iframe);
            });
        }

        function embedPost(postId) {
            if (loadedIds.has(postId) || postId < 1) return;
            loadedIds.add(postId);

            const container = document.getElementById('postsContainer');
            const wrapper = document.createElement('div');
            wrapper.className = 'widget-post';
            wrapper.id = `post-${postId}`;
            container.appendChild(wrapper);

            const script = document.createElement('script');
            script.async = true;
            script.src = 'https://telegram.org/js/telegram-widget.js?22';
            script.setAttribute('data-telegram-post', `${CHANNEL}/${postId}`);
            script.setAttribute('data-width', '100%');
            script.setAttribute('data-color', '2AABEE');
            script.setAttribute('data-dark-color', '72BCFD');
            wrapper.appendChild(script);
        }

        function loadMorePosts() {
            const btn = document.getElementById('loadMoreBtn');
            btn.disabled = true;
            btn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';

            let count = 0;
            for (let i = 0; i < POSTS_PER_PAGE && currentMaxId > 0; i++) {
                embedPost(currentMaxId);
                currentMaxId--;
                count++;
            }

            setTimeout(() => {
                btn.disabled = false;
                btn.textContent = currentMaxId > 0 ? '–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë' : '–í—Å–µ –ø–æ—Å—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                if (currentMaxId <= 0) btn.disabled = true;
            }, 1000);
        }

        async function init() {
            const info = document.getElementById('loadingInfo');

            try {
                info.textContent = '–û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç...';
                currentMaxId = await findLatestPostId();
                info.textContent = `–ù–∞–π–¥–µ–Ω–æ –ø–æ—Å—Ç–æ–≤: ~${currentMaxId}. –ó–∞–≥—Ä—É–∑–∫–∞...`;

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é –ø–æ—Ä—Ü–∏—é
                loadMorePosts();

                setTimeout(() => {
                    info.style.display = 'none';
                }, 2000);

            } catch (e) {
                console.error(e);
                // Fallback: –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–æ–≥–æ ID
                currentMaxId = 200;
                loadMorePosts();
                info.style.display = 'none';
            }
        }

        init();
    </script>
</body>
</html>